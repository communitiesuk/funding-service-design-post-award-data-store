{% extends "form_base.html" %}

{% block form_title %}
  Is there anything you need to tell us about your ratings?
{% endblock form_title %}

{% block form_content %}
  <dl class="govuk-summary-list">
    {% for page in subsection.pages %}
      {% if page.page_id != "rag-rating-information" %}
        {% set page_id_parts = page.page_id.split("-") %}
        {% set last_part = page_id_parts[-1] %}
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">{{ last_part|capitalize }}</dt>
          <dd class="govuk-summary-list__value">
            {% if page.form_data_by_instance and page.form_data_by_instance|length > 0 and page.form_data_by_instance[0] is mapping %}
              {% set rating_value = namespace(value=None) %}
              {% for key, value in page.form_data_by_instance[0].items() %}
                {% if key.endswith("_rag_rating") and not rating_value.value %}
                  {% set rating_value.value = value %}
                {% endif %}
              {% endfor %}
              {% if rating_value.value %}
                {{ rating_value.value|capitalize }}
              {% else %}
                Not provided
              {% endif %}
            {% else %}
              Not provided
            {% endif %}
          </dd>
        </div>
      {% endif %}
    {% endfor %}
  </dl>

  {% set additional_information_html %}
  {{
    form.additional_information(params={
      "hint": {"text": "Provide more detail. Do not include personal or financial information, like your National Insurance number or credit card details."},
    })
  }}
  {% endset %}

  {{
    form.any_additional_information(params={
      "items": [
        {"conditional": {"html": additional_information_html}}
      ],
    })
  }}
{% endblock %}
