{% extends "base.html" %}

{%- from 'govuk_frontend_jinja/components/file-upload/macro.html' import govukFileUpload -%}
{%- from 'govuk_frontend_jinja/components/button/macro.html' import govukButton -%}
{%- from "govuk_frontend_jinja/components/accordion/macro.html" import govukAccordion -%}
{%- from "govuk_frontend_jinja/components/accordion/macro.html" import govukNotificationBanner -%}
{%- from "errorAccordion.html" import errorAccordion -%}

{% block beforeContent %}
{{ super() }}
{% endblock beforeContent %}

{% block content %}

    <main id="main-content" role="main">
        <section class="govuk-main-wrapper">
            <div class="govuk-width-container">

                {% if not tab_errors %}
                    <h1 class="govuk-heading-l">Get ready to submit your monitoring and evaluation data return</h1>

                    {% if days_to_deadline > 0 %}
                        {% set notificationHTML %}
                          <p class="govuk-notification-banner__heading">
                            You have {{ days_to_deadline }} days left to submit your {{ returns_period }} return.
                          </p>
                        {% endset %}

                    {% else %}
                        {% set notificationHTML %}
                            <p class="govuk-notification-banner__heading">Your data return is {{ days_to_deadline|abs }} late.</p>

                            <p class="govuk-notification-banner__heading">Submit your return as soon as possible to avoid delays in your funding.</p>
                        {% endset %}
                        {% set notificationClass %} {{ "overdue-notification-banner" }} {% endset %}
                    {% endif %}

                    {{ govukNotificationBanner ({
                        "html": notificationHTML,
                        "classes": notificationClass
                    }) }}

                    <h2 class="govuk-heading-m">Upload your return for the April to September period</h2>
                    <p class="govuk-body">You are uploading for: <b>{% for la in local_authorities %}<li class="govuk-body">{{ la }}</li>{% endfor %}</b> </p>
                    <p class="govuk-body">You need to download the (LINK)[spreadsheet template]   so that you can complete the current return.</p>
                    <br>
                    <br>
                {% else %}
                    <h2 class="govuk-heading-m">There are errors in your return</h2>
                    <p class="govuk-body">The following errors have been found in your return. You need to fix them before you resubmit your file.</p>
                    {{ errorAccordion(tab_errors) }}
                {% endif %}

                <div class="upload-data-container">
                    <form method="post" action="{{ url_for('main.upload') }}" enctype="multipart/form-data">
                        {% if not pre_error %}
                            {{ govukFileUpload({'id': 'ingest_spreadsheet',
                             "hint": {"text": "Upload an Excel file"},
                             "label": {"text": ""},
                             'name': 'ingest_spreadsheet'}) }}
                        {% else %}
                            {{ govukFileUpload({'id': 'ingest_spreadsheet',
                             "hint": {"text": "Upload an Excel file"},
                             "label": {"text": ""},
                             "errorMessage": {"text": pre_error[0]},
                             'name': 'ingest_spreadsheet'}) }}
                        {% endif %}
                        {{ govukButton({"element": "button",
                        "text": "Continue",
                        "attributes": {
                            "aria-controls": "example-id",
                            "data-tracking-dimension": 123} }) }}
                    </form>
                </div>
            </div>
        </section>
    </main>

{% endblock content %}
