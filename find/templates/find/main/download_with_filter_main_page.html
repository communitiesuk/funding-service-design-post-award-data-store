{% extends "find/base.html" %}

{%- from "govuk_frontend_jinja/components/accordion/macro.html" import govukAccordion -%}
{%- from 'govuk_frontend_jinja/components/checkboxes/macro.html' import govukCheckboxes -%}
{%- from 'govuk_frontend_jinja/components/select/macro.html' import govukSelect -%}
{%- from 'govuk_frontend_jinja/components/button/macro.html' import govukButton -%}
{%- from 'govuk_frontend_jinja/components/label/macro.html' import govukLabel -%}
{%- from 'govuk_frontend_jinja/components/error-summary/macro.html' import govukErrorSummary -%}
{%- from "find/main/outcomeCheckboxes.html" import outcomeCheckboxItems -%}
{%- from "find/main/checkboxes.html" import checkboxItems -%}
{%- from "find/main/select.html" import selectItems -%}

{% block content %}
<div class="govuk-grid-row">
  <br>

	<div class="govuk-grid-column-two-thirds">
    {% if form.errors %}
      {{ govukErrorSummary ({
        "titleText": "There is a problem",
        "errorList": [
          {
            "text": "Please select a filter",
          },

        ]
      })
    }}

    {% endif %}

    <h1 class="govuk-heading-l">Filter selection</h1>

    <div class="govuk-width-container">
      <p class="govuk-body">After selecting all filters you need, click <b>'Download Data'</b></p>
    </div>

        <form  method="post" action="{{ url_for('find.download_with_filter') }}">
            {{ form.csrf_token }}

            <hr>

            <div class="govuk-inset-text">
              {{
                  form.action_choice(
                      params={
                        "fieldset": {
                          "legend": {
                            "text": form.action_choice.label.text,
                            "classes": "govuk-!-font-weight-bold"
                          },
                        }
                      }
                    )
              }}
              <button class="govuk-button" type="submit" name="action" value="filter">
                Submit
            </button>
            </div>

            <button class="govuk-button" type="submit" name="action" value="finished">
              Download Data
          </button>
        </form>

        <p class="govuk-body">
            <a class="govuk-link govuk-link--no-visited-state" href="{{ url_for('find.data_glossary') }}">Access the funding glossary</a>
        </p>
  </div>

  <div class="govuk-grid-column-one-third">

    <h2 class="govuk-heading-m govuk-!-font-weight-bold govuk-!-margin-top-9">Number of matching submissions: &nbsp;&nbsp;{{ submission_count }}</h2>
    <br>
    <h2 class="govuk-heading-m">Selected filters:</h2>

    <div class="govuk-inset-text">

      {% if selected_funds or selected_regions or selected_organisations or selected_outcome_categories or selected_from_quarter %}

        {% if selected_funds %}
          <p class="govuk-body govuk-!-font-weight-bold">Funds:</p>
          <ul class="govuk-list govuk-list--bullet">
            {% for fund in selected_funds %}
              <li>{{ fund.name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if selected_regions %}
          <p class="govuk-body govuk-!-font-weight-bold">Regions:</p>
          <ul class="govuk-list govuk-list--bullet">
            {% for region in selected_regions %}
              <li>{{ region.name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if selected_organisations %}
          <p class="govuk-body govuk-!-font-weight-bold">Organisations:</p>
          <ul class="govuk-list govuk-list--bullet">
            {% for organisation in selected_organisations %}
              <li>{{ organisation.name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if selected_outcome_categories %}
        <p class="govuk-body govuk-!-font-weight-bold">Outcome categories:</p>
        <ul class="govuk-list govuk-list--bullet">
          {% for outcome_category in selected_outcome_categories %}
            <li>{{ outcome_category }}</li>
          {% endfor %}
        </ul>
        {% endif %}

        {% if selected_from_quarter and selected_from_year %}
          <p class="govuk-body govuk-!-font-weight-bold">Returns Period (from):</p>
          <ul class="govuk-list govuk-list--bullet">
            <li>Quarter {{ selected_from_quarter }}, &nbsp;{{ selected_from_year }}</li>
          </ul>
        {% endif %}

        {% if selected_to_quarter and selected_to_year %}
          <p class="govuk-body govuk-!-font-weight-bold">Returns Period (to):</p>
          <ul class="govuk-list govuk-list--bullet">
            <li>Quarter {{ selected_to_quarter }}, &nbsp;{{ selected_to_year }}</li>
          </ul>
        {% endif %}

      {% else %}
        <p class="govuk-body">No filters selected.</p>
      {% endif %}

    </div>
  </div>

</div>

{% endblock content %}
