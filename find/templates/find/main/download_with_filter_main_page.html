{% extends "find/base.html" %}

{%- from "govuk_frontend_jinja/components/accordion/macro.html" import govukAccordion -%}
{%- from 'govuk_frontend_jinja/components/checkboxes/macro.html' import govukCheckboxes -%}
{%- from 'govuk_frontend_jinja/components/select/macro.html' import govukSelect -%}
{%- from 'govuk_frontend_jinja/components/button/macro.html' import govukButton -%}
{%- from 'govuk_frontend_jinja/components/label/macro.html' import govukLabel -%}
{%- from 'govuk_frontend_jinja/components/error-summary/macro.html' import govukErrorSummary -%}
{%- from "find/main/outcomeCheckboxes.html" import outcomeCheckboxItems -%}
{%- from "find/main/checkboxes.html" import checkboxItems -%}
{%- from "find/main/select.html" import selectItems -%}

{% block content %}
<div class="govuk-grid-row">
  <br>

	<div class="govuk-grid-column-two-thirds">
    {% if form.errors %}
      {{ govukErrorSummary ({
        "titleText": "There is a problem",
        "errorList": [
          {
            "text": "Please select",
          },

        ]
      })
    }}

    {% endif %}

        <!-- <h1 class="govuk-heading-xl">Get monitoring and evaluation data</h1> -->

        <!-- <p class="govuk-body">Use the filters to select the data you need.</p>
        <p class="govuk-body">You will get all of the data from all projects and programmes if you do not select any filters.</p>
        -->

    <div class="govuk-width-container">
      <h4 class="govuk-body">You can choose a filter, and will be redirected to select.</h4>
      <h4 class="govuk-body">When finished, please select 'FINISHED SELECTING FILTERS'</h4>
    </div>

        <form  method="post" action="{{ url_for('find.download_with_filter') }}">
            {{ form.csrf_token }}

            <hr>

            <div class="govuk-inset-text">
              {{
                  form.action_choice(
                      params={
                        "fieldset": {
                          "legend": {
                            "text": form.action_choice.label.text,
                            "classes": "govuk-!-font-weight-bold"
                          },
                        }
                      }
                    )
              }}
              {{ form.download_with_filter_confirm }}
            </div>
        </form>

        <p class="govuk-body">
            <a class="govuk-link govuk-link--no-visited-state" href="{{ url_for('find.data_glossary') }}">Access the funding glossary</a>
        </p>
  </div>

  <div class="govuk-grid-column-one-third">

    <h2 class="govuk-heading-m govuk-!-font-weight-bold">Number of submissions: &nbsp;&nbsp;{{ submission_count }}</h2>
    <br>
    <h2 class="govuk-heading-m">Selected filters:</h2>

    <div class="govuk-inset-text">

      {% if selected_funds or selected_regions or selected_organisations %}

        {% if selected_funds %}
          <p class="govuk-body govuk-!-font-weight-bold">Selected funds:</p>
          <ul class="govuk-list govuk-list--bullet">
            {% for fund in selected_funds %}
              <li>{{ fund.name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if selected_regions %}
          <p class="govuk-body govuk-!-font-weight-bold">Selected regions:</p>
          <ul class="govuk-list govuk-list--bullet">
            {% for region in selected_regions %}
              <li>{{ region.name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if selected_organisations %}
          <p class="govuk-body govuk-!-font-weight-bold">Selected organisations:</p>
          <ul class="govuk-list govuk-list--bullet">
            {% for organisation in selected_organisations %}
              <li>{{ organisation.name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

      {% else %}
        <p class="govuk-body">No filters selected.</p>
      {% endif %}

    </div>
  </div>

</div>

{% endblock content %}
